<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title><%= title %></title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1000px; margin: 20px auto; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ccc; padding: 6px; font-size: 13px; }
        th { background-color: #f5f5f5; }
        form.inline { display: inline-block; margin: 0; }
        .badge { font-size: 11px; padding: 2px 6px; border-radius: 4px; }
        .badge.notice { background-color: #ffeb3b; }
        .badge.free { background-color: #e0e0e0; }
        .pagination { margin-top: 15px; text-align: center; }
        .pagination a { margin: 0 3px; text-decoration: none; }
        .pagination .current { font-weight: bold; text-decoration: underline; }
    </style>
</head>
<body>
<header>
    <div>
        <a href="/admin">← 관리자</a> | <a href="/board">게시판</a>
    </div>
    <div>
        <% if (user) { %>
            <span><%= user.name %> (관리자)</span>
            <a href="/logout">로그아웃</a>
        <% } %>
    </div>
</header>

<h2>게시글 관리</h2>

<form method="get" action="/admin/posts">
    <select name="type">
        <option value="" <%= !type ? 'selected' : '' %>>전체</option>
        <option value="NOTICE" <%= type === 'NOTICE' ? 'selected' : '' %>>공지</option>
        <option value="FREE" <%= type === 'FREE' ? 'selected' : '' %>>자유</option>
    </select>
    <input type="text" name="keyword" placeholder="제목 검색" value="<%= keyword || '' %>">
    <button type="submit">검색</button>
</form>

<table>
    <thead>
        <tr>
            <th style="width: 60px;">ID</th>
            <th>제목</th>
            <th style="width: 120px;">작성자</th>
            <th style="width: 80px;">분류</th>
            <th style="width: 80px;">조회수</th>
            <th style="width: 150px;">작성일</th>
            <th style="width: 200px;">관리</th>
        </tr>
    </thead>
    <tbody>
        <% if (posts.length === 0) { %>
            <tr><td colspan="7" style="text-align:center;">게시글이 없습니다.</td></tr>
        <% } else { %>
            <% posts.forEach(function(post) { %>
                <tr>
                    <td><%= post.post_id %></td>
                    <td><a href="/board/<%= post.post_id %>"><%= post.title %></a></td>
                    <td><%= post.writer_name %></td>
                    <td>
                        <% if (post.type === 'NOTICE') { %>
                            <span class="badge notice">공지</span>
                        <% } else { %>
                            <span class="badge free">자유</span>
                        <% } %>
                    </td>
                    <td><%= post.view_count %></td>
                    <td><%= post.created_at %></td>
                    <td>
                        <% if (post.type !== 'NOTICE') { %>
                            <form class="inline" method="post" action="/admin/posts/<%= post.post_id %>/notice">
                                <button type="submit">공지로</button>
                            </form>
                        <% } %>
                        <% if (post.type !== 'FREE') { %>
                            <form class="inline" method="post" action="/admin/posts/<%= post.post_id %>/free">
                                <button type="submit">자유로</button>
                            </form>
                        <% } %>
                        <form class="inline" method="post" action="/admin/posts/<%= post.post_id %>/delete"
                              onsubmit="return confirm('정말 삭제하시겠습니까?');">
                            <button type="submit">삭제</button>
                        </form>
                    </td>
                </tr>
            <% }) %>
        <% } %>
    </tbody>
</table>

<div class="pagination">
    <% for (let p = 1; p <= totalPages; p++) { %>
        <% if (p === currentPage) { %>
            <span class="current"><%= p %></span>
        <% } else { %>
            <a href="/admin/posts?page=<%= p %>&type=<%= type || '' %>&keyword=<%= keyword || '' %>"><%= p %></a>
        <% } %>
    <% } %>
</div>

</body>
</html>